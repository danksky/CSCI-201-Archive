package dkawalsk_CSCI201L_Assignment2;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.io.PrintWriter;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Scanner;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import javax.xml.parsers.ParserConfigurationException;

import org.xml.sax.SAXException;

import DOM.DOMParser;

/**
 * Servlet implementation class LoginServlet
 */
@WebServlet("/IFS")
public class InputFileServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

	public InputFileServlet() {
		super();
		System.out.println("in construction");
	}

	protected void service(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		System.out.println("in service");

		// Take the string name of the input file.
		String inputFileName = (String) request.getParameter("filenameinput");
		System.out.println(inputFileName);

		HttpSession session = request.getSession(true);
		// Check that the file actually exists...
		if (null == getClass().getClassLoader().getResource(inputFileName)) {
			session.setAttribute("error", "This file name doesn't exist in the project directory!");
			response.sendRedirect("inputFileEntryError.jsp");
		} else {
			// redirect to the new login page
			session.setAttribute("inputfilename", inputFileName);
			File file = new File(getClass().getClassLoader().getResource(inputFileName).getFile());
//			session.setAttribute("inputfile", getClass().getClassLoader().getResource(inputFileName).getFile());
			DOMParser dp;
			try {
				dp = new DOMParser(file);
				dp.instantiateValues();
				String outcome = dp.check();
				if (outcome.equals(DOMParser.DATABASE_PASSES)) {
					response.sendRedirect("login.jsp");
				} else {
					session.setAttribute("error", outcome);
					response.sendRedirect("inputFileEntryError.jsp");
				}
			} catch (ParserConfigurationException | SAXException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			
		}
	}
}
